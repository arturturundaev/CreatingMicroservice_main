# Создание микросервисов. Сэм Ньюмен. O'REILLY.
## Выжимка основных идей и понятий

# Микросервисы
### Преимущества:
#### 1. Сокрытие бизнес-процессов

Только в одном месте находится бизнес-логика поведения, для всех ругих систем он выступает как черный ящик.<br>
Если необходимо внести изменение, то изменения будут только одном месте.
#### 2. Независимость развертывания
Если вносится правка в конкретный микросервис, то он может и должен быть оттесирован отдельно.<br>
После успешной разработки вылить можно правки в прод только по данному сервису, что позволияет быстрее доставлять в продакшен необходимый функционал.
#### 3. Использование необходимых технологий
Для сервиса можно выбрать свой необходимый набор технологий (язык разработки, БД и т.д.). Выбор технологии не влияет на интеграцию, т.к. взаимодействие сервисов происходит по единым протоколам (http, AMPQ)
#### 4. Дешевое масштабирование
При увеличении нагрузки нужно добавить сервисных мощностей только на необходимый сервис, а не на весь монолит
#### 5. Уменьшение сроков и стоимости тестирования
Если изменения в микросервисе не вносились, то нет необхоидмости тестировать реализовонную в нем функциональность.
#### 6. Переиспользование готового и протестированного функционала<br>
При необходимости можно использовать готовое решения для других проектов
### Недостатки:
#### 1. В начале бОльшая стоимость
Разработка любого нового микросервиса занимает напорядки больше времени, чем внесение правок в текущий монолит.
Далее внесение изменений стоит гараздо меньше за счет того, что правки вносятся только в одном сервисе и только его необходимо тестировать.
#### 2. Аггрегирование логов
При нескольких микросервисах логи аггрегируются в одной системе (ElasticSearch), но тяжело понять такие какие логи от нескольких систем в одному бизнес-процессу.<br>
Для корректной выборки нужных логов необходимо использовать единый ключ бизнес-процесса. Первичный сервис создает уникальный идентификатор процесса (UUID) и передает его в вызываемые сервисы. Вызываемые сервисы получают полученный уникальный идентификатор процесса (UUID) и используют его в своих логах.<br>
Зная уникальный идентификатор процесса (UUID) можно легко и быстро получить все необходимые логи.<br>
Можно использовать OpenTelemetry
#### 3. Двухфазная транзакция
В монолите единая БД, и транзакционная целостность легко реализуется. Но когда несколько сервисов с разделенными БД, поддерживать транзакционную целостность.<br>
Необходимо использовать двухфазную транзакцию: только если внешний сервис успешно сохранил данные, можно сохранять в текущей системе. Если в текущей системе не удалось сохранить, то необходимо вызывать внешний сервис по откату данных или подтверждение что данные сохранены.
#### 4. Отчетность.
Если ранее можно было составить большой SQL-запрос и получить все данные, то при разделенных Базах Данных придется аггригировать данные. 
#### 5. Man in the middle.
Т.к. общение происходит по сети, то возможна утечка данных
#### 6. Возможно увеличение времени работы.
Т.к. ранее было общение только FRONT <--> BACK <--> DB, то с микросервисами могут быть сетевые задержки.
#### 7. Согласованность данных.
Ранее только в одной БД хранились БД. При микросервисной архитектуре данные хранятся в разных БД, и возможна ситуация несогласованности данных. 

### Важно
1. Четко разграничить границы микросервиса. Разделение происходит по бизнес-процесам.
2. Отдельная База Данных
3. Соблюдение контрактов (обратная совместимость)
4. "Микросервис должен быть разером с вашу голову" (бизнес-процессы должны легко помещаться в голове)


